---
title: "Nayrakuen Merch API Documentation"
summary: "Complete guide for managing customers, payments, and QRIS email system for nayrakuen with comprehensive endpoint documentation and examples."
publishedAt: "2025-09-03"
tag: "API Documentation"
---

## Overview

The Nayrakuen Merch API provides a comprehensive customer management system with automated email notifications and QRIS payment integration for VALZSTORE. This system handles customer registration, payment status tracking, redeem code management, and automated email confirmations.

## Base URL and Authentication

**Production API:** `https://v2.jkt48connect.com/api/nayrakuen/`

All endpoints require authentication using these parameters:
- **username**: `vzy`
- **password**: `vzy`

Authentication can be sent via query string (GET/DELETE methods) or request body (POST/PUT methods).

```javascript
// Query string authentication (GET/DELETE)
const response = await fetch(
  'https://v2.jkt48connect.com/api/nayrakuen/pembeli?username=vzy&password=vzy'
);

// Request body authentication (POST/PUT)
const response = await fetch(
  'https://v2.jkt48connect.com/api/nayrakuen/customer-input',
  {
    method: 'POST',
    headers: { 'Content-Type': 'application/json' },
    body: JSON.stringify({
      username: 'vzy',
      password: 'vzy',
      nama: 'John Doe',
      email: 'john@example.com',
      // other parameters...
    })
  }
);
```

## Database Schema

The system uses PostgreSQL with the following table structures:

```sql
-- Customer table
CREATE TABLE pembeli (
  id SERIAL PRIMARY KEY,
  customer_id VARCHAR(50) UNIQUE,
  phone VARCHAR(20),
  name VARCHAR(255),
  address TEXT,
  email VARCHAR(255),
  product VARCHAR(255),
  harga DECIMAL(15,2),
  member VARCHAR(10) DEFAULT 'no',
  status VARCHAR(20) DEFAULT 'belum bayar',
  created_at TIMESTAMP DEFAULT NOW(),
  updated_at TIMESTAMP DEFAULT NOW()
);

-- Redeem codes table
CREATE TABLE redeem_codes (
  id SERIAL PRIMARY KEY,
  code VARCHAR(20) UNIQUE,
  email VARCHAR(255),
  discount_type VARCHAR(20) DEFAULT 'nominal',
  discount_value DECIMAL(15,2) DEFAULT 0,
  discount_percentage DECIMAL(5,2) DEFAULT 0,
  is_active BOOLEAN DEFAULT true,
  is_used BOOLEAN DEFAULT false,
  created_at TIMESTAMP DEFAULT NOW()
);
```

## Customer Management

### Add New Customer

Register a new customer with automatic QRIS generation and email confirmation.

**Endpoint:** `POST /customer-input`

```javascript
const addCustomer = async (customerData) => {
  try {
    const response = await fetch(
      'https://v2.jkt48connect.com/api/nayrakuen/customer-input',
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: 'vzy',
          password: 'vzy',
          nama: customerData.name,
          alamat: customerData.address,
          nomor_hp: customerData.phone,
          email: customerData.email,
          harga: customerData.price,
          product: customerData.product || 'Produk Default',
          member: customerData.member || 'no'
        })
      }
    );
    
    const result = await response.json();
    return result;
  } catch (error) {
    console.error('Error adding customer:', error);
    throw error;
  }
};

// Usage example
const newCustomer = await addCustomer({
  name: 'John Doe',
  address: 'Jl. Example No. 123',
  phone: '08123456789',
  email: 'john@example.com',
  price: 100000,
  product: 'Premium Package'
});
```

**Response Structure:**
```json
{
  "status": true,
  "message": "Data pembeli berhasil disimpan dan email konfirmasi telah dikirim",
  "data": {
    "customer_id": "CUST-A1B2C3D4",
    "nama": "John Doe",
    "alamat": "Jl. Example No. 123",
    "nomor_hp": "08123456789",
    "email": "john@example.com",
    "product": "Produk Default",
    "member": "no",
    "price_details": {
      "basePrice": 100000,
      "ongkir": 25000,
      "fee": 250,
      "total": 125250
    },
    "status": "belum bayar",
    "created_at": "2024-01-01T10:00:00.000Z",
    "qris_generated": true,
    "email_sent": true
  }
}
```

### Get All Customer Data

Retrieve all customer records from the database.

**Endpoint:** `GET /pembeli`

```javascript
const getAllCustomers = async () => {
  try {
    const response = await fetch(
      'https://v2.jkt48connect.com/api/nayrakuen/pembeli?username=vzy&password=vzy'
    );
    
    const result = await response.json();
    
    if (result.status) {
      console.log(`Found ${result.count} customers`);
      return result.data;
    } else {
      throw new Error(result.message);
    }
  } catch (error) {
    console.error('Error fetching customers:', error);
    throw error;
  }
};

// Process customer data
const customers = await getAllCustomers();
const paidCustomers = customers.filter(customer => customer.status === 'lunas');
const unpaidCustomers = customers.filter(customer => customer.status === 'belum bayar');

console.log(`Paid customers: ${paidCustomers.length}`);
console.log(`Unpaid customers: ${unpaidCustomers.length}`);
```

### Delete Customer Data

Remove customer records based on search criteria.

**Endpoint:** `DELETE /delete-customer`

```javascript
const deleteCustomer = async (searchCriteria) => {
  try {
    const params = new URLSearchParams({
      username: 'vzy',
      password: 'vzy',
      ...searchCriteria
    });
    
    const response = await fetch(
      `https://v2.jkt48connect.com/api/nayrakuen/delete-customer?${params}`,
      { method: 'DELETE' }
    );
    
    const result = await response.json();
    return result;
  } catch (error) {
    console.error('Error deleting customer:', error);
    throw error;
  }
};

// Delete by email
await deleteCustomer({ email: 'john@example.com' });

// Delete by name (partial match)
await deleteCustomer({ nama: 'John' });

// Delete by price
await deleteCustomer({ harga: '125250' });
```

## Payment Status Management

### Enhanced Status Update with Email

Update payment status with automatic email notifications when status becomes "lunas" (paid).

**Endpoint:** `PUT /edit-status`

```javascript
const updatePaymentStatus = async (searchCriteria, newStatus = 'lunas', sendEmail = true) => {
  try {
    const response = await fetch(
      'https://v2.jkt48connect.com/api/nayrakuen/edit-status',
      {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: 'vzy',
          password: 'vzy',
          status: newStatus,
          send_email: sendEmail.toString(),
          ...searchCriteria
        })
      }
    );
    
    const result = await response.json();
    
    if (result.status && result.email_sent) {
      console.log('Payment confirmed and customer notified via email');
    }
    
    return result;
  } catch (error) {
    console.error('Error updating status:', error);
    throw error;
  }
};

// Confirm payment by email
await updatePaymentStatus({ email: 'john@example.com' });

// Confirm payment by name without email
await updatePaymentStatus({ nama: 'John Doe' }, 'lunas', false);

// Update to different status
await updatePaymentStatus({ email: 'john@example.com' }, 'pending');
```

### Simple Status Update without Email

Update payment status without sending email notifications.

**Endpoint:** `PUT /edit-status-simple`

```javascript
const updateStatusSimple = async (searchCriteria, status = 'lunas') => {
  try {
    const response = await fetch(
      'https://v2.jkt48connect.com/api/nayrakuen/edit-status-simple',
      {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: 'vzy',
          password: 'vzy',
          status: status,
          ...searchCriteria
        })
      }
    );
    
    return await response.json();
  } catch (error) {
    console.error('Error updating status:', error);
    throw error;
  }
};
```

## Price Management

### Reduce Customer Price

Apply discounts or price reductions to customer orders.

**Endpoint:** `PUT /kurangi-harga`

```javascript
const reducePrice = async (identifier, reductionAmount) => {
  try {
    const response = await fetch(
      'https://v2.jkt48connect.com/api/nayrakuen/kurangi-harga',
      {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: 'vzy',
          password: 'vzy',
          jumlah_kurang: reductionAmount,
          ...identifier
        })
      }
    );
    
    const result = await response.json();
    
    if (result.status) {
      console.log(`Price reduced from ${result.data.harga_sebelum} to ${result.data.harga_sesudah}`);
    }
    
    return result;
  } catch (error) {
    console.error('Error reducing price:', error);
    throw error;
  }
};

// Reduce price by email
await reducePrice({ email: 'john@example.com' }, 25000);

// Reduce price by name
await reducePrice({ nama: 'John Doe' }, 10000);
```

### Search by Price

Search customers based on price criteria with various operators.

**Endpoint:** `GET /cari-harga`

```javascript
const searchByPrice = async (priceOptions) => {
  try {
    const params = new URLSearchParams({
      username: 'vzy',
      password: 'vzy',
      ...priceOptions
    });
    
    const response = await fetch(
      `https://v2.jkt48connect.com/api/nayrakuen/cari-harga?${params}`
    );
    
    return await response.json();
  } catch (error) {
    console.error('Error searching by price:', error);
    throw error;
  }
};

// Search exact price
const exactPrice = await searchByPrice({ harga: 100000 });

// Search price greater than value
const higherPrices = await searchByPrice({ 
  harga: 50000, 
  operator: 'greater' 
});

// Search price range
const priceRange = await searchByPrice({ 
  harga_min: 100000, 
  harga_max: 200000 
});

// Available operators: equal, greater, less, greater_equal, less_equal
```

## Redeem Code Management

### Create Redeem Code

Generate new redeem codes for specific customers with discount values.

**Endpoint:** `POST /buat-redeem`

```javascript
const createRedeemCode = async (redeemData) => {
  try {
    const response = await fetch(
      'https://v2.jkt48connect.com/api/nayrakuen/buat-redeem',
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: 'vzy',
          password: 'vzy',
          email: redeemData.email,
          code: redeemData.customCode, // optional
          discount_type: redeemData.discountType || 'nominal',
          discount_value: redeemData.discountValue || 0,
          discount_percentage: redeemData.discountPercentage || 0
        })
      }
    );
    
    const result = await response.json();
    
    if (result.status) {
      console.log(`Redeem code created: ${result.data.code}`);
    }
    
    return result;
  } catch (error) {
    console.error('Error creating redeem code:', error);
    throw error;
  }
};

// Create nominal discount redeem code
await createRedeemCode({
  email: 'customer@example.com',
  discountType: 'nominal',
  discountValue: 50000
});

// Create percentage discount redeem code
await createRedeemCode({
  email: 'vip@example.com',
  discountType: 'percentage',
  discountPercentage: 15
});

// Create custom redeem code
await createRedeemCode({
  email: 'special@example.com',
  customCode: 'SPECIAL2024',
  discountType: 'nominal',
  discountValue: 100000
});
```

### List All Redeem Codes

Retrieve all redeem codes in the system.

**Endpoint:** `GET /lihat-redeem`

```javascript
const getAllRedeemCodes = async () => {
  try {
    const response = await fetch(
      'https://v2.jkt48connect.com/api/nayrakuen/lihat-redeem?username=vzy&password=vzy'
    );
    
    const result = await response.json();
    
    if (result.status) {
      console.log(`Found ${result.count} redeem codes`);
      
      // Categorize codes
      const activeCodes = result.data.filter(code => code.is_active && !code.is_used);
      const usedCodes = result.data.filter(code => code.is_used);
      const inactiveCodes = result.data.filter(code => !code.is_active);
      
      console.log(`Active: ${activeCodes.length}, Used: ${usedCodes.length}, Inactive: ${inactiveCodes.length}`);
      
      return {
        all: result.data,
        active: activeCodes,
        used: usedCodes,
        inactive: inactiveCodes
      };
    }
    
    return result;
  } catch (error) {
    console.error('Error fetching redeem codes:', error);
    throw error;
  }
};

const redeemCodes = await getAllRedeemCodes();
```

### Delete Redeem Code

Remove redeem codes from the system.

**Endpoint:** `DELETE /hapus-redeem/:code` or `GET /hapus-redeem?code=XXXXX`

```javascript
const deleteRedeemCode = async (code) => {
  try {
    // Method 1: Path parameter
    const response1 = await fetch(
      `https://v2.jkt48connect.com/api/nayrakuen/hapus-redeem/${code}?username=vzy&password=vzy`,
      { method: 'DELETE' }
    );
    
    // Method 2: Query parameter
    const response2 = await fetch(
      `https://v2.jkt48connect.com/api/nayrakuen/hapus-redeem?code=${code}&username=vzy&password=vzy`,
      { method: 'DELETE' }
    );
    
    return await response1.json(); // Use either response
  } catch (error) {
    console.error('Error deleting redeem code:', error);
    throw error;
  }
};

// Delete specific redeem code
await deleteRedeemCode('A1B2C3D4E5');
```

## QRIS Payment Integration

### Manual QRIS Generation

Generate QRIS codes for specific payment amounts with optional fees.

**Endpoint:** `GET /generate-qris`

```javascript
const generateQRIS = async (qrisOptions) => {
  try {
    const params = new URLSearchParams({
      username: 'vzy',
      password: 'vzy',
      amount: qrisOptions.amount,
      includeFee: qrisOptions.includeFee || false,
      feeType: qrisOptions.feeType || 'rupiah',
      fee: qrisOptions.fee || '0'
    });
    
    const response = await fetch(
      `https://v2.jkt48connect.com/api/nayrakuen/generate-qris?${params}`
    );
    
    const result = await response.json();
    
    if (result.status) {
      console.log(`QRIS generated for amount: ${result.data.amount}`);
      console.log(`QR Image URL: ${result.data.qrImageUrl}`);
    }
    
    return result;
  } catch (error) {
    console.error('Error generating QRIS:', error);
    throw error;
  }
};

// Generate simple QRIS
const basicQRIS = await generateQRIS({ amount: 100000 });

// Generate QRIS with fixed fee
const withFeeQRIS = await generateQRIS({
  amount: 150000,
  includeFee: true,
  feeType: 'rupiah',
  fee: '2500'
});

// Generate QRIS with percentage fee
const percentageFeeQRIS = await generateQRIS({
  amount: 200000,
  includeFee: true,
  feeType: 'percentage',
  fee: '2.5'
});
```

## Email Services

### Shipping Notification Email

Send shipping confirmation emails with tracking information to customers.

**Endpoint:** `POST /kirim-email-pengiriman` or `GET /kirim-email-pengiriman`

**Required Parameters:**
- `nomor_resi` (string, **mandatory**): Tracking number for the shipment
- `kurir` (string, **mandatory**): Courier service name
- At least one search parameter: `nama`, `email`, or `nomor_hp`

```javascript
const sendShippingNotification = async (shippingData) => {
  try {
    const response = await fetch(
      'https://v2.jkt48connect.com/api/nayrakuen/kirim-email-pengiriman',
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: 'vzy',
          password: 'vzy',
          // Required shipping parameters
          nomor_resi: shippingData.trackingNumber,  // MANDATORY
          kurir: shippingData.courierName,          // MANDATORY
          // At least one search parameter required
          email: shippingData.customerEmail,
          nama: shippingData.customerName,
          nomor_hp: shippingData.phoneNumber,
          // Optional parameters
          estimasi_tiba: shippingData.estimatedArrival || '2-3 hari kerja'
        })
      }
    );
    
    const result = await response.json();
    
    if (result.status) {
      console.log(`Shipping notification sent to ${result.data.emails_sent} customers`);
    }
    
    return result;
  } catch (error) {
    console.error('Error sending shipping notification:', error);
    throw error;
  }
};

// Example usage with required parameters
await sendShippingNotification({
  trackingNumber: 'JNE001234567890',    // MANDATORY
  courierName: 'JNE Express',           // MANDATORY
  customerEmail: 'john@example.com',    // At least one search param required
  estimatedArrival: '3-4 hari kerja'
});

// Search by multiple criteria
await sendShippingNotification({
  trackingNumber: 'TIKI987654321',      // MANDATORY
  courierName: 'TIKI Reguler',          // MANDATORY
  nama: 'John Doe',
  nomor_hp: '08123456789'
});
```

**Response Structure:**
```json
{
  "status": true,
  "message": "Email informasi pengiriman berhasil diproses. 1 email terkirim dari 1 customer yang ditemukan",
  "data": {
    "customers_found": 1,
    "emails_sent": 1,
    "processed_customers": [
      {
        "customer_id": "CUST-A1B2C3D4",
        "nama": "John Doe",
        "email": "john@example.com",
        "nomor_hp": "08123456789",
        "email_sent": true
      }
    ],
    "shipping_info": {
      "kurir": "JNE Express",
      "nomor_resi": "JNE001234567890",
      "estimasi_tiba": "3-4 hari kerja"
    }
  }
}
```

**Important Notes:**
- `nomor_resi` and `kurir` parameters are **mandatory** and must be provided
- At least one search parameter (`nama`, `email`, or `nomor_hp`) is required to find customers
- The system will send shipping notifications to all customers matching the search criteria
- Email includes unboxing video requirements and tracking information
- Can be used with both GET and POST methods

### Manual Success Email

Send payment confirmation emails manually.

**Endpoint:** `POST /send-success-email`

```javascript
const sendSuccessEmail = async (customerInfo) => {
  try {
    const response = await fetch(
      'https://v2.jkt48connect.com/api/nayrakuen/send-success-email',
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: 'vzy',
          password: 'vzy',
          customer_id: customerInfo.customerId,
          nama: customerInfo.name,
          email: customerInfo.email,
          harga: customerInfo.amount
        })
      }
    );
    
    const result = await response.json();
    
    if (result.status) {
      console.log(`Success email sent to ${customerInfo.email}`);
    }
    
    return result;
  } catch (error) {
    console.error('Error sending success email:', error);
    throw error;
  }
};

// Send manual success email
await sendSuccessEmail({
  customerId: 'CUST-A1B2C3D4',
  name: 'John Doe',
  email: 'john@example.com',
  amount: 125250
});
```
### Search Customer Data (Simple)

Search customers based on name, email, or phone number with pagination support.

**Endpoint:** `GET /cari-data` or `POST /cari-data`

```javascript
const searchCustomers = async (searchOptions) => {
  try {
    const params = new URLSearchParams({
      username: 'vzy',
      password: 'vzy',
      ...searchOptions
    });
    
    const response = await fetch(
      `https://v2.jkt48connect.com/api/nayrakuen/cari-data?${params}`
    );
    
    const result = await response.json();
    
    if (result.status) {
      console.log(`Found ${result.count} customers on page ${result.pagination.current_page}`);
      console.log(`Total pages: ${result.pagination.total_pages}`);
    }
    
    return result;
  } catch (error) {
    console.error('Error searching customers:', error);
    throw error;
  }
};

// Search by name (partial match)
const byName = await searchCustomers({ 
  nama: 'John',
  limit: 10 
});

// Search by email (partial match)
const byEmail = await searchCustomers({ 
  email: 'gmail.com',
  limit: 20 
});

// Search by phone number (partial match)
const byPhone = await searchCustomers({ 
  nomor_hp: '0812',
  offset: 50,
  limit: 25 
});

// Multiple criteria (uses OR logic)
const multiSearch = await searchCustomers({
  nama: 'John',
  email: 'example.com',
  limit: 15
});
```
**Simple Search Parameters:**
- `nama` - Search by customer name (partial match)
- `email` - Search by email (partial match)  
- `nomor_hp` - Search by phone number (partial match)

**Response Structure:**
```json
{
  "status": true,
  "message": "Data berhasil ditemukan",
  "pagination": {
    "current_page": 1,
    "total_pages": 5,
    "per_page": 10,
    "total_data": 45,
    "has_next": true,
    "has_prev": false
  },
  "search_criteria": {
    "nama": "John",
    "email": null,
    "nomor_hp": null
  },
  "count": 10,
  "data": [
    {
      "customer_id": "CUST-A1B2C3D4",
      "nama": "John Doe",
      "alamat": "Jl. Example No. 123",
      "nomor_hp": "08123456789",
      "email": "john@example.com",
      "product": "Premium Package",
      "member": "no",
      "harga": 125250,
      "status": "lunas",
      "created_at": "2024-01-01T10:00:00.000Z",
      "updated_at": "2024-01-01T15:30:00.000Z"
    }
  ]
}
```
### Search Customer Data (Advanced)

Advanced search with multiple filters, sorting, and comprehensive statistics.

**Endpoint:** `GET /cari-data-advanced` or `POST /cari-data-advanced`

```javascript
const searchCustomersAdvanced = async (advancedOptions) => {
  try {
    const response = await fetch(
      'https://v2.jkt48connect.com/api/nayrakuen/cari-data-advanced',
      {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({
          username: 'vzy',
          password: 'vzy',
          ...advancedOptions
        })
      }
    );
    
    const result = await response.json();
    
    if (result.status) {
      console.log(`Advanced search found ${result.count} customers`);
      console.log('Statistics:', result.statistics);
    }
    
    return result;
  } catch (error) {
    console.error('Error in advanced search:', error);
    throw error;
  }
};

// Search paid customers with high value orders
const highValuePaid = await searchCustomersAdvanced({
  status: 'lunas',
  harga_min: 200000,
  sort_by: 'harga',
  sort_order: 'DESC',
  limit: 20
});

// Search by date range and member status
const membersByDate = await searchCustomersAdvanced({
  member: 'yes',
  tanggal_dari: '2024-01-01',
  tanggal_sampai: '2024-12-31',
  sort_by: 'created_at',
  sort_order: 'ASC'
});

// Complex search with multiple criteria
const complexSearch = await searchCustomersAdvanced({
  nama: 'John',
  status: 'belum bayar',
  harga_min: 50000,
  harga_max: 300000,
  sort_by: 'harga',
  sort_order: 'DESC',
  limit: 50
});

// Get all customers sorted by latest first
const latestCustomers = await searchCustomersAdvanced({
  sort_by: 'created_at',
  sort_order: 'DESC',
  limit: 100
});
```

**Advanced Search Parameters:**
- `nama` - Search by customer name (partial match)
- `email` - Search by email (partial match)  
- `nomor_hp` - Search by phone number (partial match)
- `status` - Filter by payment status (`lunas`, `belum bayar`, etc.)
- `member` - Filter by membership status (`yes`, `no`, or `all`)
- `harga_min` - Minimum price filter
- `harga_max` - Maximum price filter
- `tanggal_dari` - Start date filter (YYYY-MM-DD)
- `tanggal_sampai` - End date filter (YYYY-MM-DD)
- `sort_by` - Column to sort by (`name`, `email`, `phone`, `harga`, `status`, `created_at`, `updated_at`)
- `sort_order` - Sort direction (`ASC` or `DESC`)
- `limit` - Results per page (default: 50)
- `offset` - Pagination offset (default: 0)

**Advanced Search Response:**
```json
{
  "status": true,
  "message": "Data berhasil ditemukan dengan filter advanced",
  "pagination": {
    "current_page": 1,
    "total_pages": 3,
    "per_page": 20,
    "total_data": 58,
    "has_next": true,
    "has_prev": false
  },
  "search_criteria": {
    "nama": null,
    "email": null,
    "nomor_hp": null,
    "status": "lunas",
    "member": null,
    "harga_range": {
      "min": 200000,
      "max": null
    },
    "tanggal_range": {
      "dari": null,
      "sampai": null
    },
    "sort": {
      "by": "harga",
      "order": "DESC"
    }
  },
  "statistics": {
    "total_customers": 58,
    "lunas_count": 58,
    "belum_bayar_count": 0,
    "total_harga": 15420000,
    "avg_harga": 265862.07,
    "max_harga": 500000,
    "min_harga": 200000
  },
  "count": 20,
  "data": [
    // Customer data array
  ]
}
```

## Complete Workflow Implementation

Here's a complete workflow implementation showing how to use multiple endpoints together:

```javascript
class NayraluenMerchAPI {
  constructor() {
    this.baseURL = 'https://v2.jkt48connect.com/api/nayrakuen';
    this.auth = { username: 'vzy', password: 'vzy' };
  }
  
  async registerCustomer(customerData) {
    // Step 1: Register new customer
    const customer = await this.addCustomer(customerData);
    console.log(`Customer registered: ${customer.data.customer_id}`);
    
    // Step 2: Generate QRIS if needed
    if (!customer.data.qris_generated) {
      const qris = await this.generateQRIS({ 
        amount: customer.data.price_details.total 
      });
      console.log('QRIS generated manually');
    }
    
    return customer;
  }
  
  async processPayment(customerEmail) {
    // Step 1: Confirm payment status
    const statusUpdate = await this.updatePaymentStatus(
      { email: customerEmail }, 
      'lunas'
    );
    
    if (statusUpdate.status) {
      console.log('Payment confirmed and customer notified');
      
      // Step 2: Create reward redeem code for loyal customers
      await this.createRedeemCode({
        email: customerEmail,
        discountType: 'nominal',
        discountValue: 25000
      });
      
      console.log('Loyalty redeem code created');
    }
    
    return statusUpdate;
  }
  
  async applyDiscount(customerEmail, discountAmount) {
    // Step 1: Reduce customer price
    const priceReduction = await this.reducePrice(
      { email: customerEmail }, 
      discountAmount
    );
    
    if (priceReduction.status) {
      // Step 2: Generate new QRIS with updated amount
      const newQRIS = await this.generateQRIS({ 
        amount: priceReduction.data.harga_sesudah 
      });
      
      // Step 3: Send updated payment details
      console.log(`Discount applied. New amount: ${priceReduction.data.harga_sesudah}`);
      
      return {
        priceReduction,
        newQRIS
      };
    }
    
    return priceReduction;
  }
  
  async getDashboardData() {
    // Get comprehensive dashboard data
    const [customers, redeemCodes] = await Promise.all([
      this.getAllCustomers(),
      this.getAllRedeemCodes()
    ]);
    
    // Calculate statistics
    const stats = {
      totalCustomers: customers.length,
      paidCustomers: customers.filter(c => c.status === 'lunas').length,
      unpaidCustomers: customers.filter(c => c.status === 'belum bayar').length,
      totalRevenue: customers
        .filter(c => c.status === 'lunas')
        .reduce((sum, c) => sum + parseFloat(c.harga), 0),
      activeRedeemCodes: redeemCodes.filter(r => r.is_active && !r.is_used).length,
      usedRedeemCodes: redeemCodes.filter(r => r.is_used).length
    };
    
    return { customers, redeemCodes, stats };
  }
  
  // Individual method implementations would go here...
  // (addCustomer, updatePaymentStatus, etc.)
}

// Usage example
const api = new NayraluenMerchAPI();

// Complete customer flow
async function handleNewOrder() {
  try {
    // Register customer
    const customer = await api.registerCustomer({
      name: 'Jane Smith',
      address: 'Jl. Commerce St. 456',
      phone: '08987654321',
      email: 'jane@example.com',
      price: 150000,
      product: 'Premium Merchandise'
    });
    
    // Simulate payment confirmation after customer pays
    setTimeout(async () => {
      await api.processPayment('jane@example.com');
    }, 300000); // 5 minutes later
    
    // Get dashboard update
    const dashboard = await api.getDashboardData();
    console.log('Dashboard stats:', dashboard.stats);
    
  } catch (error) {
    console.error('Order processing error:', error);
  }
}

handleNewOrder();
```

## Error Handling

All API responses follow a consistent format. Here's how to handle errors properly:

```javascript
class APIError extends Error {
  constructor(message, status, response) {
    super(message);
    this.name = 'APIError';
    this.status = status;
    this.response = response;
  }
}

const handleAPIResponse = async (response) => {
  const data = await response.json();
  
  if (!response.ok) {
    throw new APIError(
      data.message || 'API request failed',
      response.status,
      data
    );
  }
  
  if (!data.status) {
    throw new APIError(data.message || 'Operation failed', 400, data);
  }
  
  return data;
};

// Usage with error handling
const safeAPICall = async (apiFunction) => {
  try {
    return await apiFunction();
  } catch (error) {
    if (error instanceof APIError) {
      console.error(`API Error (${error.status}): ${error.message}`);
      
      // Handle specific error cases
      switch (error.status) {
        case 401:
          console.error('Authentication failed. Check username/password.');
          break;
        case 404:
          console.error('Data not found.');
          break;
        case 400:
          console.error('Invalid request parameters.');
          break;
        default:
          console.error('Unexpected error occurred.');
      }
    } else {
      console.error('Network or unexpected error:', error);
    }
    
    throw error;
  }
};
```

## Common Error Responses

**Authentication Error (401):**
```json
{
  "status": false,
  "message": "Username atau password salah"
}
```

**Validation Error (400):**
```json
{
  "status": false,
  "message": "Parameter wajib tidak boleh kosong"
}
```

**Not Found Error (404):**
```json
{
  "status": false,
  "message": "Data tidak ditemukan"
}
```

**Conflict Error (409):**
```json
{
  "status": false,
  "message": "Email sudah terdaftar dalam database"
}
```

## Dependencies and Setup

Required Node.js dependencies for implementing this API:

```json
{
  "dependencies": {
    "express": "^4.x.x",
    "nodemailer": "^6.x.x",
    "pg": "^8.x.x",
    "crypto": "built-in",
    "node-fetch": "^3.x.x"
  }
}
```

Configuration file structure:

```javascript
// config.js
module.exports = {
  api: {
    baseURL: 'https://v2.jkt48connect.com/api/nayrakuen',
    username: 'vzy',
    password: 'vzy'
  },
  smtp: {
    user: 'your-email@zoho.com',
    password: 'your-app-password',
    host: 'smtp.zoho.com',
    port: 587,
    secure: false
  },
  database: {
    host: 'localhost',
    port: 5432,
    database: 'nayraluen_db',
    user: 'db_user',
    password: 'db_password'
  }
};
```

## Best Practices

1. **Always validate input data** before sending API requests
2. **Implement proper error handling** for all API calls
3. **Use environment variables** for sensitive configuration
4. **Implement retry logic** for network failures
5. **Cache frequently accessed data** to reduce API calls
6. **Log API interactions** for debugging and monitoring
7. **Validate email addresses** before customer registration
8. **Handle concurrent operations** carefully to avoid data conflicts

## Support and Maintenance

For technical support and API access:
- **Contact**: Valzy
- **API Version**: 2.0
- **Last Updated**: September 2025
- **Base URL**: `https://v2.jkt48connect.com/api/nayrakuen/`

This comprehensive API provides all necessary functionality for managing a complete e-commerce customer lifecycle with automated email notifications and payment processing through QRIS integration
